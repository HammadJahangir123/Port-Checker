<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Port Checker Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(135deg, #f0f4f8, #e0e7ff);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      .card {
        border: none;
        border-radius: 1rem;
        overflow: hidden;
      }
      .card-body {
        background: #ffffff;
        border-radius: 1rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        padding: 2rem;
      }
      .card-title {
        font-weight: 700;
        color: #2d2f7c;
      }
      .form-label {
        font-weight: 500;
      }
      .btn-primary {
        background: linear-gradient(90deg, #4f46e5, #3b82f6);
        border: none;
        transition: 0.3s;
      }
      .btn-primary:hover {
        background: linear-gradient(90deg, #3b82f6, #2563eb);
        transform: scale(1.05);
      }
      #result .alert {
        border-radius: 0.75rem;
        font-size: 0.95rem;
        animation: fadeIn 0.4s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-5px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      footer {
        text-align: center;
        margin-top: 1.5rem;
      }
    </style>
  </head>
  <body>
    <body class="bg-light" style="background: url('/static/EGI.jpg') no-repeat center center fixed; background-size: 300px;">
    <div class="container py-5">
      <div class="card shadow-lg">
        <div class="card-body">
          <h3 class="card-title text-center mb-3">
            üöÄ Port Checker Dashboard
          </h3>
          <p class="text-muted text-center">
            Select a brand, then choose hostname or IP and click
            <strong>Check Port</strong>.
          </p>

          <div class="row g-3 align-items-end">
            <!-- Brand Dropdown -->
            <div class="col-md-4">
              <label for="brand" class="form-label">Brand</label>
              <select id="brand" class="form-select">
                {% for name in brands %}
                <option value="{{ name }}">{{ name }}</option>
                {% endfor %}
              </select>
            </div>

            <!-- Host/IP Dropdown -->
            <div class="col-md-5">
              <label for="host" class="form-label">Host/IP</label>
              <select id="host" class="form-select"></select>
            </div>

            <!-- Port Field -->
            <div class="col-md-2">
              <label for="port" class="form-label">Port</label>
              <input id="port" class="form-control text-center fw-bold" readonly />
            </div>

            <!-- Check Button -->
            <div class="col-md-1 d-grid">
              <button id="checkBtn" class="btn btn-primary">Check</button>
            </div>
          </div>

          <hr />

          <div id="result" class="mt-3"></div>
        </div>
      </div>

      <footer class="mt-3 text-muted small">
        üí° Tip: Edit the <code>BRANDS</code> dict in <code>app.py</code> to add/change entries.
      </footer>
    </div>

    <script>
      const BRANDS = {{ brands | tojson }};

      function populateHosts(brandName) {
        const hostSelect = document.getElementById("host");
        hostSelect.innerHTML = "";
        BRANDS[brandName].forEach(([host, port]) => {
          const opt = document.createElement("option");
          opt.value = host;
          opt.textContent = host;
          opt.dataset.port = port;
          hostSelect.appendChild(opt);
        });
        document.getElementById("port").value = BRANDS[brandName][0][1];
      }

      document.addEventListener("DOMContentLoaded", () => {
        const brandSelect = document.getElementById("brand");
        populateHosts(brandSelect.value);

        brandSelect.addEventListener("change", () =>
          populateHosts(brandSelect.value)
        );

        document.getElementById("host").addEventListener("change", (e) => {
          const port = e.target.selectedOptions[0].dataset.port;
          document.getElementById("port").value = port;
        });

        document
          .getElementById("checkBtn")
          .addEventListener("click", async () => {
            const host = document.getElementById("host").value;
            const port = parseInt(document.getElementById("port").value, 10);
            const btn = document.getElementById("checkBtn");
            btn.disabled = true;
            btn.innerText = "Checking...";
            document.getElementById("result").innerHTML = "";

            try {
              const resp = await fetch("/check", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ host, port }),
              });
              const data = await resp.json();
              const el = document.getElementById("result");
              if (data.status === "open") {
                el.innerHTML = `<div class="alert alert-success">‚úÖ Port <strong>${port}</strong> on <strong>${host}</strong> is <strong>OPEN</strong> (checked in ${data.ms} ms)</div>`;
              } else {
                el.innerHTML = `<div class="alert alert-danger">‚ùå Port <strong>${port}</strong> on <strong>${host}</strong> is <strong>CLOSED</strong> (reason: ${data.reason})</div>`;
              }
            } catch (err) {
              document.getElementById(
                "result"
              ).innerHTML = `<div class="alert alert-warning">‚ö†Ô∏è Error: ${err.message}</div>`;
            } finally {
              btn.disabled = false;
              btn.innerText = "Check";
            }
          });
      });
    </script>
  </body>
</html>
